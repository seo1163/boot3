<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.iu.boot3.product.ProductMapper">
	
	<insert id="setAdd" parameterType="ProductVO" useGeneratedKeys="true" keyProperty="productNum">
 		INSERT INTO PRODUCT
 		VALUES(#{productNum}, #{productName}, #{productPrice}, #{productCount}, #{productDetail})
 	</insert>
 	
 	<insert id="setFileAdd" parameterType="ProductFilesVO">
 		INSERT INTO PRODUCTFILES
 		VALUES(NULL, #{productNum}, #{fileName}, #{oriName})
 	</insert>
 	
 	<select id="getTotalCount" parameterType="Pager" resultType="java.lang.Long">
 			SELECT 
			COUNT(PRODUCTNUM) 
		 	FROM PRODUCT 
		 	WHERE PRODUCTNUM>0 and 
		 		 
			<choose>
				<when test="kind == 'col1'">
					PRODUCTNAME
				</when>
				<otherwise>
					PRODUCTDETAIL
				</otherwise>
			</choose>
			LIKE CONCAT('%',#{search},'%')
 	</select>
 	
 	<select id="getList" parameterType="Pager" resultMap="listResult">
		SELECT P.*, F.*
		FROM 
		(
			SELECT 
			* 
		 	FROM PRODUCT 
		 	WHERE PRODUCTNUM>0 and 
		 		 
			<choose>
				<when test="kind == 'col1'">
					PRODUCTNAME
				</when>
				<otherwise>
					PRODUCTDETAIL
				</otherwise>
			</choose>
			LIKE CONCAT('%',#{search},'%')
			ORDER BY PRODUCTNUM DESC
			LIMIT #{startRow}, #{perPage} 	
		 ) P
		LEFT JOIN 
		PRODUCTFILES F
		USING (PRODUCTNUM)
		
 	</select>
 	
 	<resultMap type="ProductVO" id="listResult">
    	<id column="productNum" property="productNum"/>
    	<result column="productName" property="productName"/>
    	<result column="productPrice" property="productPrice"/>
    	<result column="productCount" property="productCount"/>
    	<result column="productDetail" property="productDetail"/>
    	<collection property="productFilesVOs" javaType="List" ofType="ProductFilesVO">
    		<id column="fileNum" property="fileNum"/>
    		<result column="fileName" property="fileName"/>
    		<result column="oriName" property="oriName"/>
    	</collection>
    </resultMap>
 	
 	
 	
 
</mapper>